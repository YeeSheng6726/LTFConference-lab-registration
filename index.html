<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Registration - Lead The Future Conference 2025</title>
</head>
<body style="font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px;">
    <div style="max-width: 500px; margin: 0 auto; background: white; border-radius: 8px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        
        <!-- Header -->
        <h2 style="text-align:center; color:#2c3e50; margin-bottom: 10px;">Breakout Lab Registration</h2>
        <p style="text-align:center; color:#666; margin-bottom: 30px; font-size: 14px;">
            <b><i>Lead The Future Conference 2025</i></b>
        </p>
        
        <!-- Step 1 Label -->
        <div style="font-family: Arial, sans-serif; margin: 20px 0 10px 0; padding: 0;">
            <h3 style="margin-top: 0; color: #0d47a1; font-size: 20px;">Step 1: Choose Your Breakout Lab</h3>
        </div>

        <!-- Selected Lab Display -->
        <div id="selectedLabDisplay" style="background: #e8f5e8; border: 2px solid #27ae60; border-radius: 8px; padding: 20px; margin-bottom: 15px; text-align: center;">
            <h3 style="color: #27ae60; margin: 0 0 5px 0; font-size: 18px;">‚úÖ You're registering for:</h3>
            <p id="labNameDisplay" style="font-size: 16px; font-weight: bold; color: #2c3e50; margin: 0;"></p>
        </div>

        <!-- Reselect Note -->
        <p style="font-size: 14px; color: #666; margin: 0 0 30px 0;">
            üí°If you wish to reselect your Breakout Lab, please return to your email and select the correct Breakout Lab button.
        </p>
        
        <form id="labRegistrationForm" style="max-width: 100%;">
            
            <!-- Full Name (read-only, auto-filled) -->
            <div style="margin-bottom: 55px;">
                <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2c3e50;">Your Full Name:</label>
                <input type="text" name="participantName" id="participantNameInput" readonly 
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; box-sizing: border-box; background: #f8f9fa; color: #666;">
            </div>

            <!-- Hidden Lab Input -->
            <input type="hidden" name="selectedLab" id="selectedLabInput">
            <input type="hidden" name="ticketID" id="ticketIDInput">
            <input type="hidden" name="email" id="emailInput">

            <!-- Step 2 Label (moved outside box) -->
            <div style="font-family: Arial, sans-serif; margin: 20px 0 10px 0; padding: 0;">
                <h3 style="margin-top: 0; color: #0d47a1; font-size: 20px;">Step 2 (Optional): Upload Your Personal Photo</h3>
            </div>

            <!-- Optional Upload Message Block -->
            <div style="font-family: Arial, sans-serif; margin: 0 0 20px 0; padding: 16px; border: 1px solid #e0e0e0; border-radius: 10px; background-color: #fafafa;">
              <p style="font-size: 15px; color: #333;">
                To make your <strong>Personalised AI Agent</strong> even more unique, you may upload a photo of yourself.  
                This will allow us to create a customised AI Agent image just for you.
              </p>
              <p style="font-size: 14px; color: #666; margin-bottom: 10px;">
                ‚úÖ This step is <strong>optional</strong>. If you prefer not to upload, you can still proceed without any issues.
              </p>
            </div>

            <!-- Optional Photo Upload -->
            <div style="margin-bottom: 25px;">
                <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #2c3e50;">
                    üì∏ Upload Your Photo
                </label>
                <input type="file" name="photo" id="photoInput" accept="image/*"
                       style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                <p style="font-size: 12px; color: #666; margin-top: 8px; margin-bottom: 0;">
                    Your photo will be used for personalised AI Agent image. Accepted formats: JPG, PNG (max 5MB)
                </p>
            </div>

            <!-- Submit Button -->
            <div style="text-align: center; margin-top: 30px;">
                <button type="submit" id="submitBtn" 
                        style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; padding: 15px 40px; 
                               border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold; 
                               transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 8px rgba(52,152,219,0.3);">
                    Submit Registration
                </button>
            </div>
        </form>

        <!-- Loading / Success / Error Messages remain unchanged -->
        <div id="loadingMsg" style="display: none; text-align: center; margin-top: 20px;">
            <div style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
            <p style="color: #666; font-size: 14px;">Processing your registration... Please wait.</p>
        </div>
        <div id="successMsg" style="display: none; text-align: center; margin-top: 20px; padding: 20px; background: #d4edda; border-radius: 8px; border: 1px solid #c3e6cb;">
            <h3 style="color: #155724; margin: 0 0 10px 0;">üéâ Registration Successful!</h3>
            <p style="color: #155724; margin: 0; font-size: 14px;">
                Thank you for registering! You'll soon receive your QR ticket with all the details.
            </p>
        </div>
        <div id="errorMsg" style="display: none; text-align: center; margin-top: 20px; padding: 20px; background: #f8d7da; border-radius: 8px; border: 1px solid #f5c6cb;">
            <h3 style="color: #721c24; margin: 0 0 10px 0;">‚ùå Registration Failed</h3>
            <p style="color: #721c24; margin: 0; font-size: 14px;">
                Something went wrong. Please try again or contact support.
            </p>
        </div>
    </div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #submitBtn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(52,152,219,0.4); }
        #submitBtn:active { transform: translateY(0); }
    </style>

    <script>
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    let selectedLab = urlParams.get('selectedLab');
    const emailFromUrl = urlParams.get('email');
    const ticketIDFromUrl = urlParams.get('ticketID'); 
    const nameFromUrl = urlParams.get('participantName');
    
    // Decode lab name properly (replace + with spaces too)
    if (selectedLab) {
      selectedLab = decodeURIComponent(selectedLab).replace(/\+/g, " ");
    }
    
    // Map lab codes to display names
    const labDisplayNames = {
      'AI Data Analytics': 'ü§ñ AI Data Analytics (Edmund Hee & Christine Tee)',
      'AI Vibe Coding UX': 'üíª AI Vibe Coding + UX (Marcus Chia & Shaza Hakim)',
      'AI Automation': '‚ö° AI Automation (Chan Wei Khjan & Choon Yee Sheng)'
    };
    
    // Set colors for different labs
    const labColors = {
      'AI Data Analytics': { bg: '#e3f2fd', border: '#3498db', text: '#1976d2' },
      'AI Vibe Coding UX': { bg: '#e8f5e8', border: '#27ae60', text: '#2e7d32' },
      'AI Automation': { bg: '#fff3e0', border: '#e67e22', text: '#f57c00' }
    };
    
    // Populate form with URL data
    if (nameFromUrl) {
      document.getElementById('participantNameInput').value = nameFromUrl;
    }
    if (ticketIDFromUrl) {
      document.getElementById('ticketIDInput').value = ticketIDFromUrl; 
    }
    if (emailFromUrl) {
      document.getElementById('emailInput').value = emailFromUrl;
    }
    
    if (selectedLab && labDisplayNames[selectedLab]) {
      document.getElementById('labNameDisplay').textContent = labDisplayNames[selectedLab];
      document.getElementById('selectedLabInput').value = selectedLab;
      const colors = labColors[selectedLab];
      const displayDiv = document.getElementById('selectedLabDisplay');
      displayDiv.style.background = colors.bg;
      displayDiv.style.borderColor = colors.border;
      document.getElementById('labNameDisplay').style.color = colors.text;
    } else {
      document.getElementById('selectedLabDisplay').innerHTML = 
        '<h3 style="color: #dc3545; margin: 0;">‚ùå No lab selected</h3>' +
        '<p style="margin: 5px 0 0 0; color: #666;">Please go back to the email and select a lab.</p>';
    }

    // ‚úÖ NEW CODE: Handle form submission and send to webhook
    document.getElementById('labRegistrationForm').addEventListener('submit', async function(e) {
        e.preventDefault(); // Prevent default form submission
        
        // Show loading message
        document.getElementById('loadingMsg').style.display = 'block';
        document.getElementById('successMsg').style.display = 'none';
        document.getElementById('errorMsg').style.display = 'none';
        document.getElementById('submitBtn').disabled = true;
        
        try {
            // Prepare form data
            const formData = new FormData();
            
            // Add text fields
            formData.append('participantName', document.getElementById('participantNameInput').value);
            formData.append('selectedLab', document.getElementById('selectedLabInput').value);
            formData.append('ticketID', document.getElementById('ticketIDInput').value);
            formData.append('email', document.getElementById('emailInput').value);
            
            // Add photo if uploaded
            const photoFile = document.getElementById('photoInput').files[0];
            if (photoFile) {
                formData.append('photo', photoFile);
            }
            
            // Send to webhook
            const response = await fetch('https://ys286.zeabur.app/webhook-test/c057cf94-882e-4281-93e5-78a030c1e6d2', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                // Success
                document.getElementById('loadingMsg').style.display = 'none';
                document.getElementById('successMsg').style.display = 'block';
            } else {
                throw new Error('Server responded with error: ' + response.status);
            }
            
        } catch (error) {
            console.error('Error submitting form:', error);
            // Show error message
            document.getElementById('loadingMsg').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'block';
            document.getElementById('submitBtn').disabled = false;
        }
    });
    </script>

</body>
</html>
